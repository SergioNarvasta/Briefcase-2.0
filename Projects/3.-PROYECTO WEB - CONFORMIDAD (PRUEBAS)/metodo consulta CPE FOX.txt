&& 1 //Configuraci√≥n  MOD: W.NEGRON 21/01/22
Debug
Suspend
oSunat = Createobject("HD_CONFORMIDAD_WS.ConformidadCPE")
*1.1 //Datos a ingresar para generar token
oSunat.Client_id = "97dee99e-984b-4369-a72e-fb03a6c3defa"
oSunat.Client_secret = "caWpscwQt8zFaK5t1kgftg=="
oSunat.Username = "20601647649EFACT001"
oSunat.Password = "factu2018"

*1.2* //Datos a ingresar para consultar pendientes
FecIniPND = "2021-12-01"
FecFinPND = "2022-12-01"
codMonedaPND = ""
cod_estado = "01"
ind_contribuyente = "V"


&& oSunat = Createobject("HD_CONFORMIDAD_WS.ConformidadCPE")
TOKENS = oSunat.GeneraToken()

List_CPE_PND = oSunat.ConsultaComprobantesPND(FecIniPND,  FecFinPND,  codMonedaPND,  cod_estado,  ind_contribuyente);


Local codCpe, numSerie , numCpe , codMoneda, numRucEmi , desRazonSocialEmis , numDocIdeRecep, ;
	desRazonSocialRecep,mtoImporteTotalInd,mtoImporteTotalMasi , mtoPagoPendiente,numCuotas,fecEmision,fecVencimiento,;
	fecRegistro,codTipTransaccion,numDiasAtencion,indEstadoCpe

codCpe = ""
numSerie = ""
numCpe  = ""
codMoneda = ""
numRuc  = ""
desRazonSocialEmis =""
numDocIdeRecep = ""
desRazonSocialRecep = ""
mtoImporteTotalInd= ""
mtoImporteTotalMasi = ""
mtoPagoPendiente = ""
numCuotas = ""
fecEmision = ""
fecVencimiento = ""
fecRegistro = ""
codTipTransaccion = ""
numDiasAtencion = ""
indEstadoCpe = ""

Wait Window "ejecutando consulta a SUNAT... por favor espere" Nowait Noclear	&&Consulta Comprobante Pendiente


exiErr = At("Error",List_CPE_PND) && Verifica si existe Error

If (exiErr  = 0)
	c_exiSlash = At("|" , List_CPE_PND)
	If(c_exiSlash#0)
	
	 
		respon =  STRTOFILE( List_CPE_PND , "C:\dte_hd\lista003.txt") && appends string  
Create Cursor curPend (codigo c(2), serie C(4), numero N(10,2), moneda c(3), rucEmi c(11), nombreEmi c(100),rucRecep c(11), nombreRecep c(100),  ;
ImpTotIndividual n , impTotMasiv n ,  mtoPagoPend n,  num_cuota n , fecEmision c(10)  , fecVencimiento c(10)  , fecRegistro c(10), codTipTransaccion  c(10)  , ;
numDiasAtencion n , indEstadoCpe c(10) )
Append From ("C:\dte_hd\lista003.txt") Delimited With Character |
BROWSE 
	Endif
Endif

 
 Create Cursor curPend (codigo c(2), serie C(4), numero N(10,2), moneda c(3), ruc c(11), nombre c(100))
Append From ("S:\HDSOFT_V15\Equilibra_V00\Docs\P_Conformidad.TXT") Delimited With Character |
 
 